{"version":3,"file":"fixml-view.js","sourceRoot":"","sources":["../../../src/buffer/fixml/fixml-view.ts"],"names":[],"mappings":"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","sourcesContent":["import { MsgView } from '../msg-view'\nimport { SimpleFieldDefinition } from '../../dictionary/definition'\nimport { Structure } from '../structure'\nimport { SegmentDescription } from '../segment/segment-description'\nimport { AsciiChars } from '../ascii/'\nimport * as moment from 'moment'\nimport { TagType } from '../tag/tag-type'\n\nexport class FixmlView extends MsgView {\n\n  constructor (public readonly segment: SegmentDescription,\n               public readonly values: string[],\n               public readonly structure: Structure) {\n    super(segment, structure)\n  }\n\n  private static getTimestamp (s: string, useUtc: boolean): Date {\n    let m = moment(s)\n    return useUtc ? m.utc(true).toDate() : m.toDate()\n  }\n\n  // 01:00:08.201\n  private static getTimeOnly (s: string, useUtc: boolean): Date {\n    let m = moment(s, [moment.HTML5_FMT.TIME_MS, moment.HTML5_FMT.TIME_SECONDS])\n    return useUtc ? m.utc(true).toDate() : m.toDate()\n  }\n\n  private static getDateOnly (s: string, useUtc: boolean): Date {\n    let m = moment(s)\n    let d: Date\n    if (useUtc) {\n      d = m.utc(true).toDate()\n    } else {\n      d = m.toDate()\n    }\n    return d\n  }\n\n  // if the view is to be kept beyond the event on which it arrives, must be cloned\n  public clone (): MsgView {\n    return new FixmlView(this.segment, this.values, new Structure(this.structure.tags.clone(), this.structure.segments))\n  }\n\n  public checksum (): number {\n    return 0\n  }\n\n  protected create (singleton: SegmentDescription) {\n    return new FixmlView(singleton,\n      this.values,\n      this.structure)\n  }\n\n  protected stringAtPosition (position: number): string {\n    if (position < 0 || position >= this.values.length) {\n      throw new Error(`illegal position ${position}`)\n    }\n    return this.values[position]\n  }\n\n  protected toTyped (field: SimpleFieldDefinition): any {\n    const position: number = this.getPosition(field.tag)\n    if (position >= 0) {\n      const s: string = this.values[position]\n      switch (field.tagType) {\n        case TagType.String : {\n          return this.stringAtPosition(position)\n        }\n\n        case TagType.Int:\n        case TagType.Length: {\n          return parseInt(s, 10)\n        }\n\n        case TagType.Float: {\n          return parseFloat(s)\n        }\n\n        case TagType.Boolean: {\n          return s && s.length > 0 && AsciiChars.firstChar(s) === AsciiChars.Y\n        }\n\n        case TagType.UtcTimestamp: {\n          // 20150417-01:00:08.201\n          return FixmlView.getTimestamp(s, true)\n        }\n        // 01:00:08.201\n        case TagType.UtcTimeOnly: {\n          return FixmlView.getTimeOnly(s, true)\n        }\n\n        case TagType.UtcDateOnly: {\n          return FixmlView.getDateOnly(s, true)\n        }\n\n        case TagType.LocalDate: {\n          return FixmlView.getDateOnly(s, true)\n        }\n\n        case TagType.RawData: {\n          return Buffer.alloc(s.length, s, 'utf8')\n        }\n\n        default: {\n          return this.stringAtPosition(position)\n        }\n      }\n    }\n    return this.stringAtPosition(position)\n  }\n}\n"]}