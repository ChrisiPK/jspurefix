{"version":3,"file":"trade-capture-client.js","sourceRoot":"","sources":["../../../../src/sample/tcp/trade-capture/trade-capture-client.ts"],"names":[],"mappings":"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","sourcesContent":["import { MsgView } from '../../../buffer'\nimport { AsciiSession } from '../../../transport'\nimport { MsgType } from '../../../types'\nimport { ITradeCaptureReport, ITradeCaptureReportRequest,\n  ITradeCaptureReportRequestAck } from '../../../types/FIX4.4/repo'\nimport { IJsFixLogger, IJsFixConfig } from '../../../config'\nimport { Dictionary } from '../../../collections'\nimport { TradeFactory } from './trade-factory'\n\nexport class TradeCaptureClient extends AsciiSession {\n  private readonly logger: IJsFixLogger\n  private readonly fixLog: IJsFixLogger\n  private reports: Dictionary<ITradeCaptureReport>\n\n  constructor (public readonly config: IJsFixConfig) {\n    super(config)\n    this.logReceivedMsgs = true\n    this.reports = new Dictionary<ITradeCaptureReport>()\n    this.fixLog = config.logFactory.plain(`jsfix.${config.description.application.name}.txt`)\n    this.logger = config.logFactory.logger(`${this.me}:TradeCaptureClient`)\n  }\n\n  protected onApplicationMsg (msgType: string, view: MsgView): void {\n    this.logger.info(`${view.toJson()}`)\n    switch (msgType) {\n      case MsgType.TradeCaptureReport: {\n        // create an object and cast to the interface\n        const tc: ITradeCaptureReport = view.toObject()\n        this.reports.addUpdate(tc.TradeReportID, tc)\n        this.logger.info(`[reports: ${this.reports.count()}] received tc ExecID = ${tc.ExecID} TradeReportID  = ${tc.TradeReportID} Symbol = ${tc.Instrument.Symbol} ${tc.LastQty} @ ${tc.LastPx}`)\n        break\n      }\n\n      case MsgType.TradeCaptureReportRequestAck: {\n        const tc: ITradeCaptureReportRequestAck = view.toObject()\n        this.logger.info(`received tcr ack ${tc.TradeRequestID} ${tc.TradeRequestStatus}`)\n        break\n      }\n    }\n  }\n\n  protected onStopped (): void {\n    this.logger.info('stopped')\n  }\n\n  // use msgType for example to persist only trade capture messages to database\n  protected onDecoded (msgType: string, txt: string): void {\n    this.fixLog.info(txt)\n  }\n\n  // delimiter substitution now done in encoding\n  protected onEncoded (msgType: string, txt: string): void {\n    this.fixLog.info(txt)\n  }\n\n  private logoutTimer (logoutSeconds: number = 32) {\n    setTimeout(() => {\n      this.done()\n    }, logoutSeconds * 1000)\n  }\n\n  protected onReady (view: MsgView): void {\n    this.logger.info('ready')\n    const tcr: ITradeCaptureReportRequest = TradeFactory.tradeCaptureReportRequest('all-trades', new Date())\n    // send request to server\n    this.send(MsgType.TradeCaptureReportRequest, tcr)\n    const logoutSeconds = 32\n    this.logger.info(`will logout after ${logoutSeconds}`)\n    this.logoutTimer()\n  }\n\n  protected onLogon (view: MsgView, user: string, password: string): boolean {\n    this.logger.info(`onLogon user ${user}`)\n    return true\n  }\n}\n"]}