{"version":3,"file":"skeleton-server.js","sourceRoot":"","sources":["../../../../src/sample/tcp/recovering-skeleton/skeleton-server.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;AACA,kDAAiD;AAEjD,uCAA6C;AAGtC,IAAM,cAAc,GAApB,MAAM,cAAe,SAAQ,wBAAY;IAI9C,YAAqD,MAAoB,EACX,qBAA6B;QACzF,KAAK,CAAC,MAAM,CAAC,CAAA;QAFsC,WAAM,GAAN,MAAM,CAAc;QACX,0BAAqB,GAArB,qBAAqB,CAAQ;QAEzF,IAAI,CAAC,eAAe,GAAG,IAAI,CAAA;QAC3B,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,SAAS,MAAM,CAAC,WAAW,CAAC,WAAW,CAAC,IAAI,MAAM,CAAC,CAAA;QACzF,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,CAAA;IACtD,CAAC;IAES,gBAAgB,CAAE,OAAe,EAAE,IAAa;QAExD,QAAQ,OAAO,EAAE;YACf,OAAO,CAAC,CAAC;gBACP,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,yBAAyB,OAAO,EAAE,CAAC,CAAA;gBACpD,MAAK;aACN;SACF;IACH,CAAC;IAGS,SAAS,CAAE,OAAe,EAAE,GAAW;QAC/C,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;IACvB,CAAC;IAGS,SAAS,CAAE,OAAe,EAAE,GAAW;QAC/C,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;IACvB,CAAC;IAES,OAAO,CAAE,IAAa,EAAE,IAAY,EAAE,QAAgB;QAC9D,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,qBAAqB,IAAI,EAAE,CAAC,CAAA;QAC7C,OAAO,IAAI,CAAA;IACb,CAAC;IAES,OAAO,CAAE,IAAa;QAC9B,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;QAC3B,IAAI,IAAI,CAAC,qBAAqB,GAAG,CAAC,EAAE;YAClC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,uDAAuD,IAAI,CAAC,qBAAqB,EAAE,CAAC,CAAA;YACrG,UAAU,CAAC,GAAG,EAAE;gBACd,YAAY,CAAC,GAAG,EAAE;oBAChB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAA;oBAClC,IAAI,CAAC,IAAI,CAAC,IAAI,KAAK,CAAC,gBAAgB,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC,CAAA;gBACjD,CAAC,CAAC,CAAA;YACJ,CAAC,EAAE,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC,CAAA;SACtC;aAAM;YACL,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,gCAAgC,CAAC,CAAA;SACnD;IACH,CAAC;IAES,SAAS;QACjB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;IAC7B,CAAC;CACF,CAAA;AAvDY,cAAc;IAD1B,IAAA,qBAAU,GAAE;IAKG,WAAA,IAAA,iBAAM,EAAC,cAAc,CAAC,CAAA;IACtB,WAAA,IAAA,iBAAM,EAAC,uBAAuB,CAAC,CAAA;;GALlC,cAAc,CAuD1B;AAvDY,wCAAc","sourcesContent":["import { MsgView } from '../../../buffer'\nimport { AsciiSession } from '../../../transport'\nimport { IJsFixLogger, IJsFixConfig } from '../../../config'\nimport { inject, injectable } from 'tsyringe'\n\n@injectable()\nexport class SkeletonServer extends AsciiSession {\n  private readonly logger: IJsFixLogger\n  private readonly fixLog: IJsFixLogger\n\n  constructor (@inject('IJsFixConfig') public readonly config: IJsFixConfig,\n               @inject('dropConnectionTimeout') public readonly dropConnectionTimeout: number) {\n    super(config)\n    this.logReceivedMsgs = true\n    this.fixLog = config.logFactory.plain(`jsfix.${config.description.application.name}.txt`)\n    this.logger = config.logFactory.logger(`${this.me}`)\n  }\n\n  protected onApplicationMsg (msgType: string, view: MsgView): void {\n    // dispatch messages\n    switch (msgType) {\n      default: {\n        this.logger.info(`received message type ${msgType}`)\n        break\n      }\n    }\n  }\n\n  // use msgType for example to persist only trade capture messages to database\n  protected onDecoded (msgType: string, txt: string): void {\n    this.fixLog.info(txt)\n  }\n\n  // delimiter substitution now done in encoding\n  protected onEncoded (msgType: string, txt: string): void {\n    this.fixLog.info(txt)\n  }\n\n  protected onLogon (view: MsgView, user: string, password: string): boolean {\n    this.logger.info(`peer logs in user ${user}`)\n    return true\n  }\n\n  protected onReady (view: MsgView): void {\n    this.logger.info('onReady')\n    if (this.dropConnectionTimeout > 0) {\n      this.logger.info(`acceptor is ready for requests - drop connection in ${this.dropConnectionTimeout}`)\n      setTimeout(() => {\n        setImmediate(() => {\n          this.logger.info(`kill transport`)\n          this.stop(new Error(`loss of tcp. ${this.me}`))\n        })\n      }, this.dropConnectionTimeout * 1000)\n    } else {\n      this.logger.info(`acceptor is ready for requests`)\n    }\n  }\n\n  protected onStopped (): void {\n    this.logger.info('stopped')\n  }\n}\n"]}