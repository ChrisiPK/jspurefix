{"version":3,"file":"xsd-parser.js","sourceRoot":"","sources":["../../../../src/dictionary/parser/fixml/xsd-parser.ts"],"names":[],"mappings":";;;AAGA,yBAAwB;AAIxB,MAAsB,SAAS;IAK7B,YAAuC,WAA2B;QAA3B,gBAAW,GAAX,WAAW,CAAgB;QAJlD,SAAI,GAAmB,EAAE,CAAA;IAKzC,CAAC;IAEM,KAAK,CAAE,IAAY;QACxB,OAAO,IAAI,OAAO,CAAiB,CAAC,MAAM,EAAE,MAAM,EAAE,EAAE;YACpD,MAAM,IAAI,GAAkB,EAAE,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAA;YACrD,MAAM,SAAS,GAAc,OAAO,CAAC,KAAK,CAAC,CAAC,YAAY,CAAC,IAAI,EAAE,EAAE,CAAC,CAAA;YAClE,MAAM,SAAS,GAAc,SAAS,CAAC,OAAO,CAAA;YAC9C,SAAS,CAAC,EAAE,CAAC,SAAS,EAAE,CAAC,IAAI,EAAE,EAAE;gBAC/B,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA;YACjC,CAAC,CAAC,CAAA;YAEF,SAAS,CAAC,EAAE,CAAC,UAAU,EAAE,CAAC,IAAY,EAAE,EAAE;gBACxC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,CAAC,CAAA;YAClC,CAAC,CAAC,CAAA;YAEF,SAAS,CAAC,EAAE,CAAC,OAAO,EAAE,GAAG,EAAE;gBACzB,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAA;YAC1B,CAAC,CAAC,CAAA;YAEF,SAAS,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,CAAS,EAAE,EAAE;gBACjC,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,CAAA;gBACZ,IAAI,CAAC,CAAC,MAAM,GAAG,CAAC,IAAI,IAAI,CAAC,OAAO,EAAE;oBAChC,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAA;iBAC5C;YACH,CAAC,CAAC,CAAA;YAEF,SAAS,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,CAAC,EAAE,EAAE;gBAC1B,MAAM,CAAC,CAAC,CAAC,CAAA;YACX,CAAC,CAAC,CAAA;YACF,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAA;QACtB,CAAC,CAAC,CAAA;IACJ,CAAC;IAMS,MAAM,CAAE,IAAc,EAAE,MAAqB;QACrD,IAAI,CAAC,MAAM,EAAE;YACX,MAAM,GAAG,IAAI,CAAC,OAAO,CAAA;SACtB;QACD,MAAM,IAAI,GAAa,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAA;QACnD,KAAK,IAAI,CAAC,IAAI,IAAI,EAAE;YAClB,MAAM,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAA;SAC/B;IACH,CAAC;CACF;AApDD,8BAoDC","sourcesContent":["import { FixDefinitions } from '../../definition'\nimport { ILooseObject } from '../../../collections/collection'\nimport { SAXStream } from '../../dict-primitive'\nimport * as fs from 'fs'\nimport { SAXParser } from 'sax'\nimport { ISaxNode } from '../../sax-node'\n\nexport abstract class XsdParser {\n  public readonly data: ILooseObject[] = []\n  public current: ILooseObject\n  protected pending: string\n\n  protected constructor (public readonly definitions: FixDefinitions) {\n  }\n\n  public parse (file: string): Promise<FixDefinitions> {\n    return new Promise<FixDefinitions>((accept, reject) => {\n      const pass: fs.ReadStream = fs.createReadStream(file)\n      const saxStream: SAXStream = require('sax').createStream(true, {})\n      const saxParser: SAXParser = saxStream._parser\n      saxStream.on('opentag', (node) => {\n        this.open(saxParser.line, node)\n      })\n\n      saxStream.on('closetag', (name: string) => {\n        this.close(saxParser.line, name)\n      })\n\n      saxStream.on('ready', () => {\n        accept(this.definitions)\n      })\n\n      saxStream.on('text', (t: string) => {\n        t = t.trim()\n        if (t.length > 0 && this.pending) {\n          this.value(saxParser.line, this.pending, t)\n        }\n      })\n\n      saxStream.on('error', (r) => {\n        reject(r)\n      })\n      pass.pipe(saxStream)\n    })\n  }\n\n  public abstract close (line: number, node: string): void\n  public abstract open (line: number, node: ISaxNode): void\n  public abstract value (line: number, n: string, v: string): void\n\n  protected assign (node: ISaxNode, target?: ILooseObject): void {\n    if (!target) {\n      target = this.current\n    }\n    const keys: string[] = Object.keys(node.attributes)\n    for (let k of keys) {\n      target[k] = node.attributes[k]\n    }\n  }\n}\n"]}