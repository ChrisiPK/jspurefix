{"version":3,"file":"test-recovery.js","sourceRoot":"","sources":["../../../src/test/env/test-recovery.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,uCAAwG;AAIxG,uCAAoC;AAEpC,MAAa,YAAY;IAKvB,YAA6B,KAAgB,EAAkB,MAAoB;QAAtD,UAAK,GAAL,KAAK,CAAW;QAAkB,WAAM,GAAN,MAAM,CAAc;QACjF,MAAM,EAAE,GAAG,MAAM,CAAC,WAAW,CAAC,YAAY,CAAA;QAE1C,IAAI,CAAC,KAAK,GAAG,IAAI,yBAAiB,CAAC,QAAQ,EAAE,EAAE,EAAE,MAAM,CAAC,CAAA;QACxD,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,EAAE,CAAC,CAAA;QAClC,IAAI,CAAC,QAAQ,GAAG,IAAI,8BAAsB,CAAC,IAAI,CAAC,KAAK,EAAE,MAAM,CAAC,CAAA;IAChE,CAAC;IAEK,QAAQ;;YACZ,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAA;YAC5B,MAAM,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;YACnD,MAAM,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAA;QAC5B,CAAC;KAAA;IAED,UAAU,CAAE,IAAY;QACtB,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,GAAwB,EAAE,CAAY,EAAE,EAAE;YAClE,IAAI,CAAC,CAAC,SAAS,CAAC,cAAM,CAAC,YAAY,CAAC,KAAK,IAAI,EAAE;gBAC7C,GAAG,CAAC,IAAI,CAAC,yBAAiB,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,CAAA;aAChD;YACD,OAAO,GAAG,CAAA;QACZ,CAAC,EAAE,EAAE,CAAC,CAAA;IACR,CAAC;CACF;AA3BD,oCA2BC","sourcesContent":["import { FixMsgAsciiStoreResend, FixMsgMemoryStore, FixMsgStoreRecord, IFixMsgStore } from '../../store'\nimport { MsgView } from '../../buffer'\nimport { IJsFixConfig } from '../../config'\nimport { AsciiView } from '../../buffer/ascii'\nimport { MsgTag } from '../../types'\n\nexport class TestRecovery {\n  public readonly store: IFixMsgStore\n  public readonly records: FixMsgStoreRecord[]\n  public readonly recovery: FixMsgAsciiStoreResend\n\n  constructor (public readonly views: MsgView[], public readonly config: IJsFixConfig) {\n    const id = config.description.SenderCompId\n\n    this.store = new FixMsgMemoryStore(`test-${id}`, config)\n    this.records = this.getRecords(id)\n    this.recovery = new FixMsgAsciiStoreResend(this.store, config)\n  }\n\n  async populate () {\n    const records = this.records\n    const toWrite = records.map(r => this.store.put(r))\n    await Promise.all(toWrite)\n  }\n\n  getRecords (comp: string) {\n    return this.views.reduce((agg: FixMsgStoreRecord[], v: AsciiView) => {\n      if (v.getString(MsgTag.SenderCompID) === comp) {\n        agg.push(FixMsgStoreRecord.toMsgStoreRecord(v))\n      }\n      return agg\n    }, [])\n  }\n}\n"]}