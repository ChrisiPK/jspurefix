{"version":3,"file":"session-state.test.js","sourceRoot":"","sources":["../../../src/test/ascii/session-state.test.ts"],"names":[],"mappings":"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","sourcesContent":["import 'reflect-metadata'\n\nimport { SessionState,TickAction, FixSessionState } from '../../transport'\n\nlet state: FixSessionState\nlet now: Date\n\nbeforeEach(async () => {\n  state = new FixSessionState({ heartBeat: 30 })\n  state.state = SessionState.InitiationLogonResponse\n  now = new Date(2018, 0, 1, 20, 0, 0, 0)\n  state.LastSentAt = now\n  state.lastReceivedAt = now\n  state.peerHeartBeatSecs = 30\n  state.lastPeerMsgSeqNum = 1\n})\n\ntest('do nothing', () => {\n  const action: TickAction = state.calcAction(now)\n  expect(action).toEqual(TickAction.Nothing)\n})\n\ntest('heartbeat', () => {\n  const next = new Date(now.getTime() + 31 * 1000)\n  state.lastReceivedAt = next\n  const action: TickAction = state.calcAction(next)\n\n  expect(state.timeToDie()).toEqual(false)\n  expect(state.timeToHeartbeat()).toEqual(true)\n  expect(state.timeToTerminate()).toEqual(false)\n  expect(state.timeToTestRequest()).toEqual(false)\n\n  expect(action).toEqual(TickAction.Heartbeat)\n})\n\ntest('testrequest', () => {\n  const next = new Date(now.getTime() + 51 * 1000)\n  state.LastSentAt = next\n  const action: TickAction = state.calcAction(next)\n\n  expect(state.timeToDie()).toEqual(false)\n  expect(state.timeToHeartbeat()).toEqual(false)\n  expect(state.timeToTerminate()).toEqual(false)\n  expect(state.timeToTestRequest()).toEqual(true)\n\n  expect(action).toEqual(TickAction.TestRequest)\n})\n\ntest('testrequest - no response', () => {\n  const next = new Date(now.getTime() + 55 * 2 * 1000)\n  state.LastSentAt = next\n  state.lastTestRequestAt = now\n  const action: TickAction = state.calcAction(next)\n\n  expect(state.timeToDie()).toEqual(false)\n  expect(state.timeToHeartbeat()).toEqual(false)\n  expect(state.timeToTerminate()).toEqual(true)\n  expect(state.timeToTestRequest()).toEqual(true)\n\n  expect(action).toEqual(TickAction.TerminateOnError)\n})\n\ntest('time to die - no logout response', () => {\n  const next = new Date(now.getTime() + 20 * 1000)\n  state.state = SessionState.WaitingLogoutConfirm\n  state.LastSentAt = now\n  state.lastReceivedAt = now\n  state.logoutSentAt = now\n  const action: TickAction = state.calcAction(next)\n\n  expect(state.timeToDie()).toEqual(true)\n  expect(state.timeToHeartbeat()).toEqual(false)\n  expect(state.timeToTerminate()).toEqual(false)\n  expect(state.timeToTestRequest()).toEqual(false)\n\n  expect(action).toEqual(TickAction.Stop)\n})\n"]}